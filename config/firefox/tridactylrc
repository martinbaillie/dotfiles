" Vim-like behaviour. Removing a line from here makes the setting disappear.
sanitise tridactyllocal tridactylsync

" Plain old, new tabs.
set newtab about:blank

" Slack unread and thread shortcuts.
bind gsu composite js document.getElementsByClassName("p-channel_sidebar__link--unread")[0].click()
bind gst composite js document.getElementsByClassName("p-channel_sidebar__link--all-threads")[0].click()

" Make Tridactyl work on more sites at the expense of some security.
jsb browser.webRequest.onHeadersReceived.addListener(tri.request.clobberCSP,{urls:["<all_urls>"],types:["main_frame"]},["blocking","responseHeaders"])
command fixamo_quiet jsb tri.excmds.setpref("privacy.resistFingerprinting.block_mozAddonManager", "true").then(tri.excmds.setpref("extensions.webextensions.restrictedDomains", '""'))
command fixamo js tri.excmds.setpref("privacy.resistFingerprinting.block_mozAddonManager", "true").then(tri.excmds.setpref("extensions.webextensions.restrictedDomains", '""').then(tri.excmds.fillcmdline_tmp(3000, "Permissions added to user.js. Please restart Firefox to make them take affect.")))
fixamo_quiet

" Defaults to 300ms.
set hintdelay 100

" Lowercase makes more sense to me.
set hintuppercase false

" Allow for hint refinement.
set hintfiltermode vimperator-reflow

" Vim-styled page search
unbind <C-f>
bind / fillcmdline find
bind ? fillcmdline find -?
bind n findnext 1
bind N findnext -1
bind <Escape> composite mode normal ; hidecmdline ; nohlsearch
set incsearch true

" Allow Ctrl-a to select all in the commandline.
unbind --mode=ex <C-a>

" Allow Ctrl-c to copy in the commandline.
unbind --mode=ex <C-c>

" Move up and down using C-j/k in the commandline.
bind --mode=ex <C-k> ex.prev_completion
bind --mode=ex <C-j> ex.next_completion

" Easier full-ignore mode for macOS.
bind <C-]> mode ignore
bind --mode=ignore <Escape> mode normal

" Only hint search results on Google and DDG.
bindurl www.google.com f hint -Jc .rc > .r > a
bindurl www.google.com F hint -Jbc .rc>.r>a
bindurl ^https://duckduckgo.com f hint -Jc [class=result__a]
bindurl ^https://duckduckgo.com F hint -Jbc [class=result__a]

" Disable all default searchurls.
" See https://github.com/tridactyl/tridactyl/issues/2306#issuecomment-615798111
jsb Object.keys(tri.config.get("searchurls")).reduce((prev, u) => prev.then(_ => tri.config.set("searchurls", u, null)), Promise.resolve())

set searchurls.g https://www.google.com.au/search?q=%s
set searchurls.ddg https://duckduckgo.com/html?q=%s
set searchurls.sp https://startpage.com/do/search?language=english&cat=web&query=%s
set searchurls.gh https://github.com/search?q=%s
set searchurls.no https://search.nixos.org/options?from=0&size=15&sort=relevance&channel=unstable&query=%s
set searchurls.np https://search.nixos.org/packages?from=0&size=15&sort=relevance&channel=unstable&query=%s
set searchengine g

" New reddit design is just fucking _terrible_.
autocmd DocStart https://www.reddit.com js tri.excmds.urlmodify("-t", "www", "old")

" Gmail.
unbindurl mail.google.com j " Next email
unbindurl mail.google.com k " Previous email
unbindurl mail.google.com e " Archive
unbindurl mail.google.com u " Go back to list
unbindurl mail.google.com c " Compose
unbindurl mail.google.com x " Select conversation

unbindurl mail.google.com ga " All email
unbindurl mail.google.com gi " Inbox
unbindurl mail.google.com gl " Labels
unbindurl mail.google.com , " Focus toolbar

unbindurl mail.google.com a " Reply All
unbindurl mail.google.com r " Reply
unbindurl mail.google.com m " Mute
unbindurl mail.google.com f " Forward
unbindurl mail.google.com y " Remove label
unbindurl mail.google.com s " Star
unbindurl mail.google.com - " Not important
unbindurl mail.google.com + " Important

unbindurl mail.google.com I " Mark as read
unbindurl mail.google.com U " Mark as unread

" Scroll smoothly and slowly.
set smoothscroll true
bind j scrollline 5
bind k scrollline -5

" Use scroll keys similar to Vimium.
bind d scrollline 15
bind u scrollline -15
