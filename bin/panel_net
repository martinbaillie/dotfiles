#!/bin/sh
# 0 * * * * /usr/bin/curl ip-addr.es > ~/.current_external_ip

IF_ETHERNET="e*"
IF_WIRELESS="w*"
IF_VPN="tunsnx"
IF_CURRENT="$(ip route | grep default | head -1 | awk '{print $5}')"

if [[ "$IF_CURRENT" == $IF_ETHERNET ]]
then
    NET="%{F-} "
elif [[ "$IF_CURRENT" == $IF_WIRELESS ]]
then
    NET="%{F\$NGRN}%{F-}$(iwgetid -r) "
else
    echo "%{F\$NRED}%{F-}No network "
    exit 0
fi

IP_LAN_CURRENT=$(ip -4 a s $IF_CURRENT | grep inet | head -1 | awk 'sub(/\/24/, ""){print $2}')
IP_WAN_CURRENT="$(cat $HOME/.current_external_ip)"
IP_VPN_CURRENT=$(ifconfig $IF_VPN 2>/dev/null | grep -1 UP | tail -1 | awk '{print $2}')

LANWAN=" %{F\$NCYA}%{F-}$IP_LAN_CURRENT %{F\$NMAG}%{F-}$IP_WAN_CURRENT"
if [ ! -z "$IP_VPN_CURRENT" ];
then
    VPN="VPN/$IP_VPN_CURRENT"
fi
echo "$NET$LANWAN$VPN"
